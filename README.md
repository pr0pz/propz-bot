# __Propz Stream Bot ðŸŽ‰__

[![Made with Deno](https://img.shields.io/static/v1?label&message=Deno&color=70ffaf&logo=deno&logoColor=323330)](https://deno.com/)
![Made with Typescript](https://img.shields.io/static/v1?label&message=Typescript&color=3871c6&logo=typescript&logoColor=fff)
![Made with React](https://img.shields.io/static/v1?label&message=React&color=61dbfb&logo=react&logoColor=323330)
[![Made with Twurple](https://img.shields.io/static/v1?label&message=Twurple&color=647d0f&logo=twitch&logoColor=fff)](https://twurple.js.org/)
[![Made with Discord.js](https://img.shields.io/static/v1?label&message=Discord.js&color=379c6f&logo=discord&logoColor=fff)](https://discord.js.org/)

## __This Bot connects my Twitch Account with Discord, OBS Studio, YouTube etc..__

_Like it? I'd appreciate the support :)_

[![Watch on Twitch](https://img.shields.io/static/v1?label=Watch%20on&message=Twitch&color=bf94ff&logo=twitch&logoColor=fff)](https://propz.de/twitch/)
[![Join on Discord](https://img.shields.io/static/v1?label=Join%20on&message=Discord&color=7289da&logo=discord&logoColor=fff)](https://propz.de/discord/)
[![Donate on Ko-Fi](https://img.shields.io/static/v1?label=Donate%20on&message=Ko-Fi&color=ff5f5f&logo=kofi&logoColor=fff)](https://propz.de/kofi/)

### __Instructions__

#### __Basics__
1. [Install Deno](https://docs.deno.com/runtime/getting_started/installation/) on your Server/Computer

2. Go to the Bot folder and install all needed packages:
```sh
deno install --allow-scripts
```
3. Rename the .env.example to .env
4. Inside the .env file you'll find instructions and URL's for every used service/website (most of them are optional).

#### __Running the Bot on a Server with a FQDN__
1. Don't forget to set the right BOT_URL + BOT_PORT inside your .env
2. Set the frontend root to frontend/public/
3. Setup an apache reverse proxy for the /websocket + /webhook + /api URL to work + secure /api and /websocket with your IP's (local, server, etc):
```apacheconf
<Location "/(api|websocket)">
	Require local
	Require ip 1.2.3.4 5.6.7.8 9.0.1.2
</Location>

ProxyPass /websocket ws://localhost:1337/websocket
ProxyPassReverse /websocket ws://localhost:1337/websocket
ProxyPass /webhook http://localhost:1337/webhook
ProxyPassReverse /webhook http://localhost:1337/webhook
ProxyPass /api http://localhost:1337/api
ProxyPassReverse /api http://localhost:1337/api
ProxyPass /eventsub http://localhost:1338/eventsub
ProxyPassReverse /eventsub http://localhost:1338/eventsub
```

#### __Configuration__
Check the bot/config folder
- discordEvents: for specific Discord events
- externalStreamers: announce when different Streamers go online on Discord
- twitchEvents: for all kinds of events related to twitch (official twitch events and custom ones)
- twitchRewards: my twitch rewards. Only rewards created by the Bot can be manipulated by the Bot later on (like pause). Create your own rewards and leave reward ID blank, as it will be generated by Twitch and automaticaly saved back to the twitchRewards file
- twitchTimers: You can configure own automated messages that'll be send at minute X
- If you're using Discord: go to Discord.ts file and configure your guildId + channels and ID's

#### __Finally__

1. Build the Frontend
```sh
deno task build
````
2. Start the bot (probably on the server)
```sh
deno task bot
```
3. Start the local services - only needed for printing
```sh
deno task local
```
4. Embed frontend Routes as OBS browser sources as you like/need:
- "bot.domain.com/" : Alerts, Mediaboard, Raid Animation, EmoteEffects (rain, tornado), Ad Animation
- "bot.domain.com/chat": Stream Chat
- "bot.domain.com/events": Last Stream Events
- "bot.domain.com/focus": Focus Overlay
- "bot.domain.com/credits": Stream Credits
- "bot.domain.com/weather?cityName=Bielefeld&countryCode=de": Weather for the specified location

5. If everything is working fine, you can start the Bot with pm2 and it'll run forever and ever:
```sh
cd /to/the/folder/propz-bot/
pm2 start bot/index.ts \
	--interpreter='deno' \
	--interpreter-args='run -A --unstable-cron --env-file' \
	--name 'mySuperBotName'
```

#### __Folder Explanations__
Every Folder of the Bot has a separate purpose:
1. local-scripts: runs locally on your PC
- Automatically mutes Spotify when an Ad is playing (mac only, not needed for Spotify Premium)
- Prints shit on my Printer (only important for me)
2. frontend: Are embedded inside OBS as Browser Sources with different routes (URL's). The routes are listed above.
3. shared: Shared ressources across all folders
4. bot: Main Twitch Bot Magic connecting all services/websites


### __Misc Instructions__
- #### Updated All packages
	Run this on every folder:
    deno update --latest --allow-scripts

- #### Updated Twurple packages order
	deno i npm:@twurple/auth@latest npm:@twurple/api@latest npm:@twurple/chat@latest npm:@twurple/eventsub-ws@latest

### __Test cases__

- !test: simple text echo
- !soundboard: text echo based on config
- !chatscore dmdyy: text from own saved data
- !chatranking
- !followage dmdyy: text from own saved data
- !watchtime dmdyy: text from external SE api
- !event channelfollow: test events
- "hola": reaction
- Redeem: change background
- !streamonline: stream announcement on discord when live
- !nuke: sound and video
- !alarm: sound
- !focus: check if focus mode works
- !clear: check if stream hygiene works
- !killswitch + !event: check if killswitch works
- !vod: get last vod link
- !joke: get random joke

_That's it!_

___Be excellent to each other. And, Party on, dudes!___
